<!DOCTYPE html>
<html>
<head>
  <title>Janrain Modal Non-Redirect Signin Example</title>
<script type="https://cdnjs.cloudflare.com/ajax/libs/fetch/0.9.0/fetch.js"></script>
<script type="text/javascript">
// This is the code obtained from the Janrain dashboard.
(function() {
  if (typeof window.janrain !== 'object') window.janrain = {};
  if (typeof window.janrain.settings !== 'object') window.janrain.settings = {};

  // This is where you can add/modify Janrain Widget settings.
  app_name = '_YOUR_APP_NAME_HERE_'
  janrain.settings.tokenUrl = 'http://localhost:3000';
  janrain.settings.tokenAction = 'event';
  janrain.settings.type = 'modal';
  janrain.settings.linkClass = 'social-login-button';
  // Only edit above this line.

  function isReady() { janrain.ready = true; };
  if (document.addEventListener) {
    document.addEventListener("DOMContentLoaded", isReady, false);
  } else {
    window.attachEvent('onload', isReady);
  }

  var e = document.createElement('script');
  e.type = 'text/javascript';
  e.id = 'janrainAuthWidget';

  if (document.location.protocol === 'https:') {
    e.src = 'https://rpxnow.com/js/lib/' + app_name + '/engage.js';
  } else {
    e.src = 'http://widget-cdn.rpxnow.com/js/lib/' + app_name + '/engage.js';
  }

  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(e, s);
})();
</script>
</head>
<body>
  <!-- Notice the class on this link is the same as what we configured in
  janrain.settings.linkClass? The widget automatically attaches a click handler
  to this link. -->
  <a href="javascript:void(0)" class="social-login-button">Sign In</a>
  <div id="messageContainer"></div>
  <code><pre id="profileContainer"></pre></code>
</body>
<script>

// janrainWidgetOnLoad is a special function that gets called as soon as the the
// Janrain widget is loaded on the page. Attach all of your event handlers
// within this function.
function janrainWidgetOnload() {

  // This event fires once social login is complete. We will use it to close the
  // Janrain widget modal.
  janrain.events.onProviderLoginComplete.addHandler(function() {
    janrain.engage.signin.modal.close()
  });

  // This event fires once Janrain's Social Login service has responded with the
  // access token. We'll send this token to our token_url to retrieve the
  // profile.
  janrain.events.onProviderLoginToken.addHandler(function(response) {
    fetch('http://localhost:3000/profile?token=' + response.token).then(function(res) {
      return res.json();
    }).then(function(profile) {
      var messageContainer = document.getElementById('messageContainer');
      var profileContainer = document.getElementById('profileContainer');
      var name = profile.displayName;
      messageContainer.innerHTML = '<h1>Welcome, ' + name + '!</h1>';
      pretty_printed_profile = JSON.stringify(profile, null, 2);
      profileContainer.innerHTML = pretty_printed_profile;
    });
  })
}

</script>
</html>
